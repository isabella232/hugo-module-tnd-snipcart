{{ $s := newScratch }}
{{ $s.Set "data" dict }}
{{ $itemKey := "data-item-" }}
{{ with .Params.product }}
  {{ $s.SetInMap "data" (print $itemKey "id") $.File.UniqueID }}
  {{ $s.SetInMap "data" (print $itemKey "url") $.Permalink }}
  {{ $s.SetInMap "data" (print $itemKey "name") $.Title }}
  {{ with .price }}
  {{ $s.SetInMap "data" (print $itemKey "price") (partialCached "tnd-snipcart/private/FormatPrice" . .) }}
  {{ end }}
  {{ $description := $.Summary }}
  {{ with .description }}
    {{ $description = . }}
  {{ else }}
    {{ with $.Description }}
      {{ $description = . }}
    {{ end }}
  {{ end }}
  {{ $s.SetInMap "data" (print $itemKey "description") $description }}

  {{ with .metadata }}
    {{ $s.SetInMap "data" "metadata" (. | jsonify) }}
  {{ end }}

  {{ with .categories }}
    {{ $s.SetInMap "data" "categories" (delimit . "|") }}
  {{ end }}

  {{ with .customs }}
    {{ range $index, $custom := . }}
      {{ with .name }}
        {{ $key := print $itemKey "custom" (add $index 1) "-" }}
        {{ $s.SetInMap "data" (print $key "name") . }}
        {{ with $custom.options }}
          {{ $options := delimit . "|" }}
          {{ $s.SetInMap "data" (print $key "options") $options }}
        {{ end }}
        {{ with $custom.value }}
          {{ $s.SetInMap "data" (print $key "value") . }}
        {{ end }}
        {{ with $custom.required }}
          {{ $s.SetInMap "data" (print $key "required") true }}
        {{ end }}
        {{ with $custom.placeholder }}
          {{ $s.SetInMap "data" (print $key "placeholder") . }}
        {{ end }}
        {{ with $custom.type }}
          {{ if eq . "checkbox" "textarea" "readonly" }}
            {{ $s.SetInMap "data" (print $key "type") . }}
          {{ end }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}

{{ return $s.Get "data" }}